2. ğŸ–¥ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (payment.html)
Ù†Ø±Ø¨Ø· Ø§Ù„Ø¢Ù† Ø²Ø± Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ù€ API Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆÙ†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Paymob.

Ø£. payment.html (Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù€ JavaScript Ø¨Ù…Ù„Ù payment.html:

JavaScript

// payment.html (Ø¯Ø§Ø®Ù„ ÙˆØ³Ù… <script> - ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„)

// ===================================
// ğŸ’° Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ (Paymob) - Ø§Ù„ØªØ­Ø¯ÙŠØ«
// ===================================

/**
 * 1. Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Paymob (Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¯ÙØ¹)
 */
async function processPayment(bookingId) {
    showLoading(true);
    showAlert('', 'none');

    try {
        // Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© apiRequest Ø§Ù„Ù…ÙØªØ±Ø¶Ø© ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        const response = await apiRequest("/api/payment/initiate", 'POST', { bookingId });
        
        const { paymentToken, iframeId } = response;
        
        if (paymentToken && iframeId) {
            // ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© Paymob iFrame Ù„Ù„Ø¯ÙØ¹
            const paymobUrl = `https://accept.paymob.com/api/acceptance/iframes/${iframeId}?payment_token=${paymentToken}`;
            window.location.href = paymobUrl;
            
        } else {
            throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ØµØ­ÙŠØ­.");
        }

    } catch (error) {
        showLoading(false);
        console.error('ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙØ¹:', error);
        showAlert('ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.', 'error');
    }
}


/**
 * 2. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† Paymob (Callback)
 */
function handlePaymentCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status'); 
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø­Ø§Ù„Ø© Ø¯ÙØ¹ ÙÙŠ Ø§Ù„Ù€ URLØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if (status === 'success=true' || status === 'success=false') {
        const isSuccess = status === 'success=true';
        const statusDiv = document.getElementById('paymentStatus');
        const bookingDetailsDiv = document.getElementById('bookingDetails');
        
        bookingDetailsDiv.style.display = 'none'; 
        
        if (isSuccess) {
            showPaymentStatus('Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯ÙØ¹ ğŸ‰', 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø­Ø¬Ø²Ùƒ ÙˆØ¯ÙØ¹ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­.', 'success');
            statusDiv.innerHTML += `<a href="/profile.html" class="btn btn-success mt-4">Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</a>`;
        } else {
            showPaymentStatus('ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹ âŒ', 'ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
            statusDiv.innerHTML += `<button class="btn btn-primary mt-4" onclick="handlePaymentCallback()">Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>`;
        }
    } else {
         // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ statusØŒ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙØ¹
        loadBookingInfo(); 
    }
}

// ğŸ¯ ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    // ... (Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
    
    // ğŸ’¡ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
    handlePaymentCallback(); 
});
Ø¨Ù‡Ø°Ø§ Ù†ÙƒÙˆÙ† Ù‚Ø¯ Ø£ØªÙ…Ù…Ù†Ø§ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Paymob.
