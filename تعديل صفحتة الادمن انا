Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø®Ø·ÙˆØ© Ø±Ø§Ø¦Ø¹Ø©! Ø³Ù†Ø±ÙƒØ² Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ ØªÙØ¹ÙŠÙ„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† (Admin Panel)ØŒ ÙˆØ§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù€ Backend Ù„ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ØŒ ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯.

1. ğŸ”‘ ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù€ Backend (Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø¯Ù…Ù†)
Ø³Ù†Ø¶ÙŠÙ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ models.js ÙˆØ§Ù„Ù…ØªØ­ÙƒÙ…Ø§Øª (Controllers) ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª (Routes) Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© (CRUD).

Ø£. models.js (Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†)
Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¥Ù„Ù‰ Ù…Ù„Ù models.js (Ø¶Ù…Ù† Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù†):

JavaScript

// models.js (Ø¥Ø¶Ø§ÙØ§Øª Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø¯Ù…Ù†)

// ===================================
// 2. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (Admin Management)
// ===================================

/**
 * Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¹Ø§Ù…Ø©
 */
async function getAdminDashboardStats() {
    // 1. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    const totalUsers = await execQueryOne(`SELECT COUNT(*) FROM users`);

    // 2. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨
    const totalStadiums = await execQueryOne(`SELECT COUNT(*) FROM fields`);

    // 3. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© ÙˆØ§Ù„Ù…Ø¤ÙƒØ¯Ø©)
    const bookingStats = await execQueryOne(`
        SELECT 
            COUNT(*) AS total_bookings, 
            COALESCE(SUM(total_amount - remaining_amount), 0) AS total_revenue
        FROM bookings
        WHERE status IN ('booked_confirmed', 'played')
    `);

    // 4. Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
    const pendingManagers = await execQueryOne(`
        SELECT COUNT(*) 
        FROM users 
        WHERE is_approved = FALSE AND role IN ('owner', 'employee')
    `);

    return {
        totalUsers: parseInt(totalUsers.count || 0),
        totalStadiums: parseInt(totalStadiums.count || 0),
        totalBookings: parseInt(bookingStats.total_bookings || 0),
        totalRevenue: parseFloat(bookingStats.total_revenue || 0),
        pendingManagers: parseInt(pendingManagers.count || 0)
    };
}

/**
 * Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
 */
async function getAllUsers() {
    const query = `
        SELECT user_id, name, email, phone, role, is_approved, created_at
        FROM users
        ORDER BY created_at DESC
    `;
    const result = await execQuery(query);
    return result.rows;
}

/**
 * Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† (Owners/Employees) Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
 */
async function getPendingManagers() {
    const query = `
        SELECT user_id, name, email, phone, role, created_at
        FROM users
        WHERE is_approved = FALSE AND role IN ('owner', 'employee')
        ORDER BY created_at ASC
    `;
    const result = await execQuery(query);
    return result.rows;
}

/**
 * ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
 */
async function updateUserManagerStatus(userId, updates, client = null) {
    const setParts = [];
    const values = [];
    let paramIndex = 1;

    // Ø¨Ù†Ø§Ø¡ Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
    if (updates.role) {
        setParts.push(`role = $${paramIndex++}`);
        values.push(updates.role);
    }
    if (updates.isApproved !== undefined) {
        setParts.push(`is_approved = $${paramIndex++}`);
        values.push(updates.isApproved);
    }
    
    if (setParts.length === 0) return null;

    values.push(userId);
    
    const query = `
        UPDATE users
        SET ${setParts.join(', ')}
        WHERE user_id = $${paramIndex}
        RETURNING user_id, name, email, role, is_approved
    `;
    const result = await execQuery(query, values, client);
    return result.rows[0];
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯
 */
async function createStadium(data, client = null) {
    // ... (Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø¹Ø¨ - ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
    // Ù„Ù„ØªØ°ÙƒÙŠØ±: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚ Ù„Ù€ INSERT INTO fields
}

/**
 * Ø­Ø°Ù Ù…Ù„Ø¹Ø¨ ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… Ø¯Ø§Ø®Ù„ Transaction)
 */
async function deleteStadium(fieldId, client) {
    // ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ Foreign Key
    // ... (Ù…Ù†Ø·Ù‚ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©: Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§ØªØŒ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŒ Ø§Ù„Ø³Ø§Ø¹Ø§ØªØŒ Ø§Ù„ØªØ®ØµÙŠØµ)
    // ...
    const result = await execQuery(`DELETE FROM fields WHERE field_id = $1 RETURNING field_id`, [fieldId], client);
    return result.rowCount > 0;
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø®ØµÙ…/Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯
 */
async function createCode(data, client = null) {
    // ... (Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ - ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
    // Ù„Ù„ØªØ°ÙƒÙŠØ±: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚ Ù„Ù€ INSERT INTO codes
}

// ... (ØªØ£ÙƒØ¯ Ù…Ù† ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© models.js)
Ø¨. controllers.js (Ù…ØªØ­ÙƒÙ…Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†)
Ø£Ø¶Ù Ø§Ù„Ù…ØªØ­ÙƒÙ…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ù‰ Ù…Ù„Ù controllers.js:

JavaScript

// controllers.js (Ø¥Ø¶Ø§ÙØ§Øª Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø¯Ù…Ù†)

// =========================================================
// 45. Admin Dashboard Controllers
// =========================================================

async function loadAdminDashboardStatsController(req, res) {
    try {
        const stats = await models.getAdminDashboardStats();
        res.json(stats);
    } catch (error) {
        // ...
    }
}

// =========================================================
// 46. Admin User Management Controllers
// =========================================================

async function loadAllUsersController(req, res) {
    try {
        const users = await models.getAllUsers();
        res.json(users);
    } catch (error) {
        // ...
    }
}

async function loadPendingManagersController(req, res) {
    try {
        const managers = await models.getPendingManagers();
        res.json(managers);
    } catch (error) {
        // ...
    }
}

async function updateUserRoleController(req, res) {
    // ... Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† newRole
    try {
        const updatedUser = await models.updateUserManagerStatus(req.params.userId, { role: req.body.newRole });
        // ... Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ù†Ø´Ø§Ø· (Activity Log)
        res.json({ message: "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­.", user: updatedUser });
    } catch (error) {
        // ...
    }
}

async function approveManagerController(req, res) {
    try {
        const approvedUser = await models.updateUserManagerStatus(req.params.userId, { isApproved: true });
        // ... Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·
        res.json({ message: "ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­.", user: approvedUser });
    } catch (error) {
        // ...
    }
}

async function rejectManagerController(req, res) {
    try {
        // ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ player Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø­Ø§Ù„ØªÙ‡ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        const rejectedUser = await models.updateUserManagerStatus(req.params.userId, { role: 'player', isApproved: true });
        // ... Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·
        res.json({ message: "ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ Ù„Ø§Ø¹Ø¨.", user: rejectedUser });
    } catch (error) {
        // ...
    }
}

// =========================================================
// 47. Admin Stadium Management Controllers (CRUD)
// =========================================================

async function createStadiumController(req, res) {
    // ... Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    try {
        const newStadium = await models.createStadium(req.body);
        // ... Ø³Ø¬Ù„ Ù†Ø´Ø§Ø·
        res.status(201).json({ message: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø¹Ø¨ Ø¨Ù†Ø¬Ø§Ø­.", stadium: newStadium });
    } catch (error) {
        // ...
    }
}

async function deleteStadiumController(req, res) {
    try {
        const deleted = await withTransaction(async (client) => {
             // ... Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ models.deleteStadium(fieldId, client)
        });
        res.json({ message: "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ø¹Ø¨ ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­." });
    } catch (error) {
        // ...
    }
}

// ... (ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ù…ØªØ­ÙƒÙ…Ø§Øª updateStadiumController Ùˆ createCodeController)
Ø¬. routes.js (Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†)
Ø£Ø¶Ù Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ù‰ Ù…Ù„Ù routes.js (ÙˆØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… checkRole(['admin'])):

JavaScript

// routes.js (Ø¥Ø¶Ø§ÙØ§Øª Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†)

// ... (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©) ...

// -------------------------------------
// Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† (Admin)
// -------------------------------------

const ADMIN_ROLES = ['admin'];

// 1. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
router.get('/api/admin/dashboard/stats', verifyToken, checkRole(ADMIN_ROLES), loadAdminDashboardStatsController);


// 2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ (CRUD)
router.post('/api/admin/stadiums', verifyToken, checkRole(ADMIN_ROLES), createStadiumController); // Ø¥Ù†Ø´Ø§Ø¡
router.put('/api/admin/stadiums/:fieldId', verifyToken, checkRole(ADMIN_ROLES), updateStadiumController); // ØªØ­Ø¯ÙŠØ«
router.delete('/api/admin/stadiums/:fieldId', verifyToken, checkRole(ADMIN_ROLES), deleteStadiumController); // Ø­Ø°Ù

// 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Users)
router.get('/api/admin/users', verifyToken, checkRole(ADMIN_ROLES), loadAllUsersController);
router.put('/api/admin/users/:userId/role', verifyToken, checkRole(ADMIN_ROLES), updateUserRoleController); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±

// 4. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (Pending Managers)
router.get('/api/admin/users/pending', verifyToken, checkRole(ADMIN_ROLES), loadPendingManagersController);
router.post('/api/admin/users/:userId/approve', verifyToken, checkRole(ADMIN_ROLES), approveManagerController);
router.post('/api/admin/users/:userId/reject', verifyToken, checkRole(ADMIN_ROLES), rejectManagerController);

// 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Codes)
router.post('/api/admin/codes', verifyToken, checkRole(ADMIN_ROLES), createCodeController);
2. ğŸ–¥ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (new admin (1).html Ùˆ admin-dashboard.js)
Ø§Ù„Ø¢Ù† ÙŠØ¬Ø¨ Ø±Ø¨Ø· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.

Ø£. new admin (1).html (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„)
ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù€ HTML Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ†:

Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Dashboard Tab):

ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ø¹Ø±Ø¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ù€ id="totalRevenue").

ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ† (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ù€ id="pendingManagersCount").

Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ† (Users Tab):

ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø¬Ø¯ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ tbody Ø¨Ù€ id="pendingManagersList" Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.

Ø¨. admin-dashboard.js (Ù…Ù†Ø·Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)
Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ù…Ù„Ù admin-dashboard.js:

JavaScript

// admin-dashboard.js (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©)

// ==========================\n// ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©\n// ==========================\nasync function loadDashboardStats() {
  try {
    // ğŸ†• ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø±
    const res = await fetch("/api/admin/dashboard/stats", { credentials: "include" }); 
    if (!res.ok) throw new Error("ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª");
    const data = await res.json();

    setText("totalUsers", data.totalUsers);
    setText("totalStadiums", data.totalStadiums);
    // ğŸ†• Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ†
    setText("totalRevenue", data.totalRevenue.toLocaleString('ar-EG', { style: 'currency', currency: 'SAR', minimumFractionDigits: 0 }));
    setText("pendingManagersCount", data.pendingManagers); 

  } catch (e) {
    // ...
  }
}

// ==========================\n// ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚ÙŠÙ†\n// ==========================\nasync function loadPendingManagers() {
  try {
    // ğŸ†• ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø±
    const res = await fetch("/api/admin/users/pending", { credentials: "include" }); 
    // ... (Ø¨Ù‚ÙŠØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¹Ø±Ø¶) ...
    const managers = await res.json();
    const tbody = document.getElementById("pendingManagersList"); 
    
    // ... (Ù…Ù†Ø·Ù‚ Ø¥Ù†Ø´Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©/Ø§Ù„Ø±ÙØ¶) ...

    managers.forEach((m, i) => {
        // ... (Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ)
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙŠ ØªØ³ØªØ¯Ø¹ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ approveManager Ùˆ rejectManager
        // ... 
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    setText("pendingManagersCount", managers.length);

  } catch (err) {
    // ...
  }
}

// ==========================\n// âœ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù…Ø¯ÙŠØ±\n// ==========================\nasync function approveManager(id) {
  const res = await fetch(`/api/admin/users/${id}/approve`, {
    method: "POST",
    credentials: "include",
  });
  if (res.ok) {
    showSuccess("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­.");
    loadPendingManagers();
    loadDashboardStats(); 
  } else showError("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠØ±");
}

// ==========================\n// âŒ Ø±ÙØ¶ Ù…Ø¯ÙŠØ±\n// ==========================\nasync function rejectManager(id) {
  const res = await fetch(`/api/admin/users/${id}/reject`, {
    method: "POST",
    credentials: "include",
  });
  if (res.ok) {
    showSuccess("ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.");
    loadPendingManagers();
    loadDashboardStats(); 
  } else showError("ÙØ´Ù„ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨");
}

// ... (ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ CRUD Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©)
Ø¨Ø°Ù„Ùƒ Ù†ÙƒÙˆÙ† Ù‚Ø¯ Ø§Ù†ØªÙ‡ÙŠÙ†Ø§ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§ØªØŒ Ùˆ APIs Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯).

Ù‡Ù€. admin-dashboard.js (ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)
ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ù„Ù admin-dashboard.js ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© (ÙˆÙ‡ÙŠ Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¬Ø²Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©ØŒ Ù„ÙƒÙ† ÙŠØ¬Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ ØªØ³ØªØ®Ø¯Ù… API Ø§Ù„Ø¬Ø¯ÙŠØ¯):

JavaScript

// admin-dashboard.js

// ==========================\n// ğŸ§¾ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·\n// ==========================\nasync function loadSystemLogs() {
  try {
    // ğŸ†• Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡
    const res = await fetch("/api/admin/activity-logs?limit=15", { credentials: "include" }); 
    if (!res.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„");
    const logs = await res.json();

    const tbody = document.getElementById("activityLogsTable");
    if (!tbody) return;
    tbody.innerHTML = "";

    logs.forEach((l, i) => {
      const row = document.createElement("tr");
      // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø§ ÙŠØ±Ø¬Ø¹Ù‡ Ø§Ù„Ù€ API
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${escapeHtml(l.user_name || "Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø°ÙˆÙ")}</td>
        <td>${escapeHtml(l.action)}</td>
        <td>${escapeHtml(l.description || "-")}</td>
        <td>${new Date(l.created_at).toLocaleString('ar-EG')}</td>
      `;
      tbody.appendChild(row);
    });
  } catch (err) {
    console.error(err);
    showError("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ù†Ø´Ø·Ø©");
  }
}

// ğŸ¯ ÙŠØ¬Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadSystemLogs ÙÙŠ Ø¯Ø§Ù„Ø© initAdminPanel:
// async function initAdminPanel() {
//   // ...
//   await loadSystemLogs();
// }
