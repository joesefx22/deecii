1. âš™ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙÙŠ profile.html
Ø£. Ø¥Ø¶Ø§ÙØ© ØªØ¨ÙˆÙŠØ¨ "Ø­Ø¬ÙˆØ²Ø§ØªÙŠ"
ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø£ÙÙ‚ÙŠØ© (Tabs) ÙÙŠ Ø¬Ø³Ù… Ø§Ù„ØµÙØ­Ø©:

HTML

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="pill" data-bs-target="#profile-info" type="button" role="tab" aria-controls="profile-info" aria-selected="true">
            <i class="bi bi-person-fill"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="bookings-tab" data-bs-toggle="pill" data-bs-target="#bookings" type="button" role="tab" aria-controls="bookings" aria-selected="true" onclick="profileSystem.loadUserBookings()">
            <i class="bi bi-calendar-check"></i> Ø­Ø¬ÙˆØ²Ø§ØªÙŠ
        </button>
    </li>
</ul>

<div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="bookings" role="tabpanel" aria-labelledby="bookings-tab">
        <h3 class="mb-4 text-primary">Ù‚Ø§Ø¦Ù…Ø© Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</h3>
        <div id="userBookingsList" class="row">
            <p class="text-center text-muted mt-5">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª...</p>
        </div>
    </div>
</div>
Ø¨. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modals)
ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°ÙŠÙ† Ø§Ù„Ù€ Modal ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø¬Ø³Ù… Ø§Ù„ØµÙØ­Ø© (profile.html):

1. Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù„Ø¹Ø¨ (ratingModal)
HTML

<div class="modal fade" id="ratingModal" tabindex="-1" aria-labelledby="ratingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ratingModalLabel">ØªÙ‚ÙŠÙŠÙ… Ù…Ù„Ø¹Ø¨ <span id="ratingField" class="text-primary"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="ratingForm">
          <input type="hidden" id="ratingBookingId">
          <div class="mb-3 text-center">
            <label class="form-label d-block">Ø§Ù„Ù†Ø¬ÙˆÙ…</label>
            <div id="starRating" data-rating="0" class="d-inline-flex">
              </div>
          </div>
          <div class="mb-3">
            <label for="ratingComment" class="form-label">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea class="form-control" id="ratingComment" rows="3" maxlength="250" placeholder="Ù…Ø§ Ø±Ø£ÙŠÙƒ Ø¨Ø§Ù„Ù…Ù„Ø¹Ø¨ØŸ"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="button" class="btn btn-primary" onclick="profileSystem.submitRating()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
      </div>
    </div>
  </div>
</div>
2. Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (playerRequestModal)
HTML

<div class="modal fade" id="playerRequestModal" tabindex="-1" aria-labelledby="playerRequestModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="playerRequestModalLabel">Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø­Ø¬Ø² <span id="requestField" class="text-primary"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="playerRequestForm">
          <input type="hidden" id="requestBookingId">
          <div class="mb-3">
            <label for="playersNeeded" class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
            <input type="number" class="form-control" id="playersNeeded" min="1" required placeholder="Ù…Ø«Ø§Ù„: 3">
            <div class="form-text">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡ Ù„ÙŠÙƒØªÙ…Ù„ ÙØ±ÙŠÙ‚Ùƒ.</div>
          </div>
          <div class="mb-3">
            <label for="requestNotes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea class="form-control" id="requestNotes" rows="3" maxlength="250" placeholder="ÙˆÙ‚Øª Ø§Ù„Ø¥Ø­Ù…Ø§Ø¡ØŒ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="button" class="btn btn-success" onclick="profileSystem.createPlayerRequest()">Ù†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
    </div>
  </div>
</div>
2. ğŸ§© ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ JavaScript ÙÙŠ profile.html
Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¶Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ù€ JavaScript Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ù…Ù„Ù profile.html (ÙŠÙØ¶Ù„ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø¶Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ø³ AdvancedProfileSystem Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø¸ÙŠÙ…):

JavaScript

// profile.html (Ø¯Ø§Ø®Ù„ ÙˆØ³Ù… <script> ÙˆÙÙŠ Ù†Ø·Ø§Ù‚ AdvancedProfileSystem)

// ... (ÙŠÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø«Ù„ apiRequestØŒ showToastØŒ showLoading)

class AdvancedProfileSystem {
    constructor() {
        // ... (Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ) ...
        this.setupRatingStars();
        this.loadUserBookings(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø¹Ù†Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    }

    // ===================================
    // 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶
    // ===================================
    async loadUserBookings() {
        const listContainer = document.getElementById('userBookingsList');
        if (!listContainer) return;
        listContainer.innerHTML = '<p class="text-center text-info mt-5">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø­Ø¬ÙˆØ²Ø§ØªÙƒ...</p>';

        try {
            window.showLoading(true);
            // Ù†ÙØªØ±Ø¶ ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø± API /api/player/bookings Ù„Ø¬Ù„Ø¨ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
            const bookings = await apiRequest('/api/player/bookings', 'GET'); 
            window.showLoading(false);

            if (bookings.length === 0) {
                listContainer.innerHTML = '<p class="text-center text-muted mt-5"><i class="bi bi-info-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
                return;
            }

            listContainer.innerHTML = bookings.map(b => this.createBookingCard(b)).join('');

        } catch (error) {
            window.showLoading(false);
            window.showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ' + error.message, 'error');
            listContainer.innerHTML = '<p class="text-center text-danger mt-5">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª.</p>';
        }
    }
    
    createBookingCard(booking) {
        let statusClass = 'bg-secondary';
        let actionButton = '';

        if (booking.status === 'booked_confirmed') {
            statusClass = 'bg-success';
            // Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø¤ÙƒØ¯Ø©
            actionButton += `
                <button class="btn btn-sm btn-outline-success mt-2" 
                        onclick="profileSystem.showCreateRequestModal('${booking.booking_id}', '${booking.field_name}')">
                    <i class="bi bi-person-plus"></i> Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ†
                </button>`;
        } else if (booking.status === 'played') {
            statusClass = 'bg-primary';
            // Ø²Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªÙŠ Ø§Ù†ØªÙ‡Øª
            // Ù†ÙØªØ±Ø¶ Ø£Ù† API Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø³ÙŠØ¹Ø·ÙŠÙ†Ø§ Ø­Ù‚Ù„ has_rated
            if (!booking.has_rated) { 
                actionButton += `
                    <button class="btn btn-sm btn-warning mt-2" 
                            onclick="profileSystem.showRatingModal('${booking.booking_id}', '${booking.field_name}')">
                        <i class="bi bi-star"></i> Ù‚ÙŠÙ… Ø§Ù„Ù…Ù„Ø¹Ø¨
                    </button>`;
            } else {
                actionButton += `<span class="badge bg-secondary mt-2"><i class="bi bi-check-circle"></i> ØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</span>`;
            }
        }
        
        return `
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title text-primary">${booking.field_name}</h5>
                        <p class="card-text mb-1"><i class="bi bi-calendar-event"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong>${booking.booking_date}</strong></p>
                        <p class="card-text mb-1"><i class="bi bi-clock"></i> Ø§Ù„ØªÙˆÙ‚ÙŠØª: <strong>${booking.start_time} - ${booking.end_time}</strong></p>
                        <hr>
                        <p class="card-text mb-1">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <strong>${booking.remaining_amount} Ø±.Ø³</strong></p>
                        <p class="card-text mb-3">Ø§Ù„Ø­Ø§Ù„Ø©: <span class="badge ${statusClass}">${this.formatStatus(booking.status)}</span></p>
                        ${actionButton}
                    </div>
                </div>
            </div>
        `;
    }

    formatStatus(status) {
        const statuses = {
            'booked_confirmed': 'Ù…Ø¤ÙƒØ¯',
            'booked_unconfirmed': 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯',
            'played': 'Ù…ÙƒØªÙ…Ù„ (Ù…ÙÙ„Ø¹Ø¨)',
            'cancelled': 'Ù…Ù„ØºÙ‰',
            'missed': 'ÙØ§Ø¦Øª',
        };
        return statuses[status] || status;
    }


    // ===================================
    // 2. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
    // ===================================
    setupRatingStars() {
        const starRating = document.getElementById('starRating');
        if (!starRating) return;

        starRating.innerHTML = '';
        for (let i = 1; i <= 5; i++) {
            const star = document.createElement('i');
            star.className = 'bi bi-star me-1 fs-4 text-warning';
            star.setAttribute('data-value', i);
            star.style.cursor = 'pointer';
            star.onclick = () => this.setRating(i);
            starRating.appendChild(star);
        }
    }
    
    setRating(value) {
        const starRating = document.getElementById('starRating');
        if (!starRating) return;

        starRating.setAttribute('data-rating', value);
        starRating.querySelectorAll('i').forEach(star => {
            const starValue = parseInt(star.getAttribute('data-value'));
            star.className = starValue <= value ? 'bi bi-star-fill me-1 fs-4 text-warning' : 'bi bi-star me-1 fs-4 text-warning';
        });
    }

    showRatingModal(bookingId, fieldName) {
        const modal = new bootstrap.Modal(document.getElementById('ratingModal'));
        document.getElementById('ratingBookingId').value = bookingId;
        document.getElementById('ratingField').textContent = fieldName;
        document.getElementById('ratingComment').value = '';
        this.setRating(0); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¬ÙˆÙ…
        modal.show();
    }
    
    async submitRating() {
        const bookingId = document.getElementById('ratingBookingId').value;
        const ratingValue = parseInt(document.getElementById('starRating').getAttribute('data-rating'));
        const comment = document.getElementById('ratingComment').value.trim();

        if (ratingValue === 0) {
            window.showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ù„ØªÙ‚ÙŠÙŠÙ….', 'warning');
            return;
        }

        try {
            window.showLoading(true);
            
            await apiRequest(`/api/bookings/${bookingId}/rate`, 'POST', { 
                ratingValue, 
                comment 
            });
            
            window.showLoading(false);
            window.showToast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚ÙŠÙŠÙ…Ùƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('ratingModal'));
            modal.hide();
            
            this.loadUserBookings(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…

        } catch (error) {
            window.showLoading(false);
            window.showToast('âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ' + error.message, 'error');
        }
    }

    // ===================================
    // 3. Ø¯ÙˆØ§Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    // ===================================

    showCreateRequestModal(bookingId, fieldName) {
        const modal = new bootstrap.Modal(document.getElementById('playerRequestModal'));
        document.getElementById('requestBookingId').value = bookingId;
        document.getElementById('requestField').textContent = fieldName;
        document.getElementById('playersNeeded').value = '';
        document.getElementById('requestNotes').value = '';
        modal.show();
    }

    async createPlayerRequest() {
        const bookingId = document.getElementById('requestBookingId').value;
        const playersNeeded = parseInt(document.getElementById('playersNeeded').value);
        const notes = document.getElementById('requestNotes').value.trim();

        if (isNaN(playersNeeded) || playersNeeded <= 0) {
            window.showToast('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ† (1 Ø£Ùˆ Ø£ÙƒØ«Ø±).', 'warning');
            return;
        }

        try {
            window.showLoading(true);
            
            await apiRequest(`/api/player-requests`, 'POST', {
                bookingId,
                playersNeeded,
                notes
            });
            
            window.showLoading(false);
            window.showToast('âœ… ØªÙ… Ù†Ø´Ø± Ø·Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¢Ù†.', 'success');

            const modal = bootstrap.Modal.getInstance(document.getElementById('playerRequestModal'));
            modal.hide();
            
        } catch (error) {
            window.showLoading(false);
            window.showToast('âŒ ÙØ´Ù„ Ù†Ø´Ø± Ø·Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: ' + error.message, 'error');
        }
    }
    
    // ... (Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„ÙƒÙ„Ø§Ø³)
}

// ... (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ profileSystem = new AdvancedProfileSystem() Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
Ø¨Ù‡Ø°Ù‡ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§ØªØŒ ØªÙƒÙˆÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ profile.html Ø¬Ø§Ù‡Ø²Ø© Ø§Ù„Ø¢Ù† Ù„Ù€:

Ø¹Ø±Ø¶ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨.

ØªÙ…ÙƒÙŠÙ† ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù„Ø¹Ø¨ (Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© played).

ØªÙ…ÙƒÙŠÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠÙŠÙ† (Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© booked_confirmed).
